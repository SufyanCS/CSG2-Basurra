@{
    Layout = null;
    var courseCount = Model.Courses.Count;
    var userCount = Model.Users.Count;
    var lessonCount = Model.Lessons.Count;


}
@model Coders_Zone.Models.DashboardViewModel

<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
</head>
<body>
    <div class="d-flex flex-row flex-grow-1" style="height: 200vh";>
    <div class="d-flex flex-column flex-shrink-0 p-3 text-white bg-dark h-full col-sm-2 md:col-md-2 ">
        <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-white text-decoration-none">
          <svg class="bi me-2" width="40" height="32"></svg>
          <span class="fs-5">Coders Zone</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-auto">
          <li class="nav-item">
            <a href="#" class="nav-link text-white active" aria-current="page" onclick="showHomeForm()">
                 <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-graph-up" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M0 0h1v15h15v1H0zm14.817 3.113a.5.5 0 0 1 .07.704l-4.5 5.5a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61 4.15-5.073a.5.5 0 0 1 .704-.07" />
                 </svg>              
                 Statistics
            </a>
          </li>
          <li>
            <a href="#" class="nav-link text-white" onclick="showDashboardForm()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-collection-play" viewBox="0 0 16 16">
                            <path d="M2 3a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 0-1h-11A.5.5 0 0 0 2 3m2-2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7A.5.5 0 0 0 4 1m2.765 5.576A.5.5 0 0 0 6 7v5a.5.5 0 0 0 .765.424l4-2.5a.5.5 0 0 0 0-.848z" />
                            <path d="M1.5 14.5A1.5 1.5 0 0 1 0 13V6a1.5 1.5 0 0 1 1.5-1.5h13A1.5 1.5 0 0 1 16 6v7a1.5 1.5 0 0 1-1.5 1.5zm13-1a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-13A.5.5 0 0 0 1 6v7a.5.5 0 0 0 .5.5z" />
                        </svg>              
                        Courses
            </a>
          </li>
          <li>
            <a href="#" class="nav-link text-white" onclick="showUsersForm()">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-person-lines-fill" viewBox="0 0 16 16">
                   <path d="M6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-5 6s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zM11 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5m.5 2.5a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1zm2 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1zm0 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1z" />
                </svg>              
                Users
            </a>
          </li>
                <li>
                    <a href="#" class="nav-link text-white" onclick="showLessonsForm()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-file-text" viewBox="0 0 16 16">
                            <path d="M5 4a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1zm-.5 2.5A.5.5 0 0 1 5 6h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5M5 8a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1z" />
                            <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2zm10-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" />
                        </svg>                        Lessons
                    </a>
                </li>
                <br />
                <a href="/Login/Logout" class="active btn btn-danger" style="color: white;">Log Out</a>

        </ul>
        <hr>
    </div>


    <div class="col-sm-10 md:col-md-10 px-5 ">

            <div id="homeForm" style="display: block;">
                <div class="container">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card h-100 bg-danger p-2 text-dark bg-opacity-25">
                                <div class="card-body d-flex flex-column justify-content-center align-items-sm-center" style=" height: 250px;">
                                    <h2 class="card-title">Total Courses</h2>
                                    <h4 class="card-text fw-bold">@courseCount Courses</h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 bg-success p-2 text-dark bg-opacity-25" ;>
                                <div class="card-body d-flex flex-column justify-content-center align-items-sm-center">
                                    <h2 class="card-title">Total Lessons</h2>
                                    <h4 class="card-text fw-bold">@lessonCount Lessons</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 ">
                            <div class="card h-100 bg-primary-subtle">
                                <div class="card-body d-flex flex-column justify-content-center align-items-sm-center" style=" height: 250px;">
                                    <h2 class="card-title">Total</h2>
                                    <h4 class="card-text fw-bold"></h4>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card h-100 bg-warning p-2 text-dark bg-opacity-25">
                                <div class="card-body d-flex flex-column justify-content-center align-items-sm-center" style=" height: 250px;">
                                    <h2 class="card-title">Total Students</h2>
                                    <h4 class="card-text fw-bold">@userCount Active Student</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            </div>

        <div id="dashboardForm" style="display: none;" class="px-24">
                <div class="d-flex flex-row justify-content-between p-4">
                    <h2>Courses</h2>
                    <a asp-controller="Dashboard" asp-action="NewCourse" class="btn btn-success">New Course +</a>

                </div>
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">Course Name</th>
                <th scope="col">Category</th>
                <th scope="col">Number Of Lessons</th>
                <th scope="col">Level</th>
                <th scope="col">Student enrolled</th>
                <th>Edit</th>
                <th>Delete</th>
              </tr>
            </thead>
            <tbody>
             @foreach (var course in Model.Courses)
                        {
                            var numLessons = Model.Lessons.Count(lesson => lesson.CourseId == course.Id);

                            <tr>
                                <th scope="row">@course.Id</th>
                                <td>@course.Name</td>
                                <td>@course.Category</td>
                                <td>@numLessons Lessons</td>
                                <td>@course.Level</td>
                                <td>students</td>
                                <td><a asp-controller="Dashboard" asp-action="EditCourse" asp-route-Id="@course.Id" type="button" class="btn btn-primary">Edit</a></td>
                                <td>
                                    <form asp-controller="Dashboard" asp-action="DeleteCourse" method="post" onsubmit="return confirm('Are you sure you want to delete this Course? All related Lessons will be deleteed!');">
                                        <input type="hidden" name="Id" value="@course.Id" />
                                        <button type="submit" class="btn btn-danger">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
          </table>
        </div>



            <div id="usersForm" style="display: none;">
                <div class="d-flex flex-row justify-content-between p-4">
                    <h2>Users</h2>
                </div>
               <table class="table table-striped">
                   <thead>
                      <tr>
                        <th scope="col">#</th>
                        <th scope="col">User Name</th>
                        <th scope="col">Email</th>
                        <th scope="col">Is Admin</th>
                        <th scope="col">Regestration Date</th>
                        <th scope="col">Courses Enrolled</th>
                        <th>Banned</th>
                       </tr>
                   </thead>
                   <tbody>
                        @foreach (var user in Model.Users)
                        {
                            <tr>
                                <th scope="row">@user.Id</th>
                                <td>@user.Username</td>
                                <td>@user.Email</td>
                                <td>@user.IsAdmin</td>
                                <td>@user.RegistrationDate</td>
                                <td>
                                    @*Still Need to implement the functionality after devoloping the Enroll Button in Course Details page...*@

                                    <select class="form-select">
                                        <option>Num Of Courses = 2</option>
                                        <option>Java 101</option>
                                        <option>Mastering Python </option>
                                    </select>
                                </td>
                                <td>
                                    @if (user.IsBanned)
                                    {
                                        <form asp-controller="Dashboard" asp-action="UnbanUser" method="post" onsubmit="return confirm('Are you sure you want to Unban This User!')";>
                                            <input type="hidden" name="userId" value="@user.Id" />
                                            <button type="submit" class="btn btn-danger">Unban</button>
                                        </form>
                                    }
                                    else
                                    {
                                        <form asp-controller="Dashboard" asp-action="BanUser" method="post" onsubmit="return confirm('Are you sure you want to Ban This User!')" ;>
                                            <input type="hidden" name="userId" value="@user.Id" />
                                            <button type="submit" class="btn btn-warning">Ban</button>
                                        </form>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
               </table>
        </div>



            <div id="lessonsForm" style="display: none;">
                <div class="d-flex flex-row justify-content-between p-4">
                    <h2>Lessons</h2>
                    <a asp-controller="Dashboard" asp-action="NewLesson" class="btn btn-success">New Lesson +</a>

                </div>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Lesson Name</th>
                            <th scope="col">Course Name</th>
                            <th scope="col">Order</th>
                            <th scope="col">Duration</th>
                            <th scope="col">Edit</th>
                            <th scope="col">Delete</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var lesson in Model.Lessons)
                        {
                            <tr>
                                <th scope="row">@lesson.Id</th>
                                <td>@lesson.Name</td>
                                <td>@Model.Courses.Find(c => c.Id == lesson.CourseId)?.Name</td>
                                <td>@lesson.Order</td>
                                <td>@lesson.Duration</td>
                                <td><a type="button" asp-controller="Dashboard" asp-action="EditLesson" asp-route-Id="@lesson.Id" class="btn btn-success">Edit</a></td>

                                <td>
                                    <form asp-controller="Dashboard" asp-action="DeleteLesson" method="post" onsubmit="return confirm('Are you sure you want to delete this Lesson?');">
                                        <input type="hidden" name="Id" value="@lesson.Id" />
                                        <button type="submit" class="btn btn-danger">Delete</button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>

    </div>
  </div>
  <script>

    const navLinks = document.querySelectorAll('.nav-link');

  // Function to add active class and display the corresponding form
  function handleNavLinkClick(event) {
    event.preventDefault(); // Prevent default link behavior

    // Remove active class from all links
    navLinks.forEach(link => link.classList.remove('active'));

    // Add active class to the clicked link
    event.target.classList.add('active');

    // Get the data-form attribute value (assuming you added it)
    const formId = event.target.dataset.form;

    // Hide all forms
    const allForms = document.querySelectorAll('.form-container'); // Adjust selector if needed
    allForms.forEach(form => form.style.display = 'none');

    // Show the corresponding form based on data-form attribute
    if (formId) {
      document.getElementById(formId).style.display = 'block';
    }
  }

  // Add click event  to all navigation links
  navLinks.forEach(link => link.addEventListener('click', handleNavLinkClick));
    function changeHeading(text) {
      document.getElementById('heading').innerText = text;
    }
    
    function showHomeForm() {
      hideAllForms();
      document.getElementById('homeForm').style.display = 'block';
    }
    
    function showDashboardForm() {
      hideAllForms();
      document.getElementById('dashboardForm').style.display = 'block ';
    }
    
    function showUsersForm() {
      hideAllForms();
            document.getElementById('usersForm').style.display = 'block';
    }
        function showLessonsForm() {
            hideAllForms();
            document.getElementById('lessonsForm').style.display = 'block';
        }

    function hideAllForms() {
      document.getElementById('homeForm').style.display = 'none';
      document.getElementById('dashboardForm').style.display = 'none';
      document.getElementById('usersForm').style.display = 'none';
            document.getElementById('lessonsForm').style.display = 'none';

    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>